'use client';
import { useState } from 'react';
import Link from 'next/link';
import { getPublishedPosts, isNewBlog } from '@/data/blogPosts';
import BlogThumbnail from '@/components/BlogThumbnail';

const allTools = [
  // ... (keep all existing tools - same as before)
  { name: 'PDFçµåˆ', href: '/pdf/merge', icon: 'ğŸ“„', category: 'PDF', popular: true },
  { name: 'PDFåœ§ç¸®', href: '/pdf/compress', icon: 'ğŸ“„', category: 'PDF', popular: true },
  { name: 'PDFåˆ†å‰²', href: '/pdf/split', icon: 'ğŸ“„', category: 'PDF' },
  { name: 'PDFå›è»¢', href: '/pdf/rotate', icon: 'ğŸ“„', category: 'PDF' },
  { name: 'PDFãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è§£é™¤', href: '/pdf/unlock', icon: 'ğŸ”“', category: 'PDF', popular: true },
  { name: 'PDFãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š', href: '/pdf/protect', icon: 'ğŸ”’', category: 'PDF' },
  { name: 'PDFé€ã‹ã—', href: '/pdf/watermark', icon: 'ğŸ’§', category: 'PDF' },
  { name: 'PDFãƒšãƒ¼ã‚¸ç•ªå·', href: '/pdf/page-numbers', icon: 'ğŸ”¢', category: 'PDF' },
  { name: 'PDFç½²å', href: '/pdf/sign', icon: 'âœï¸', category: 'PDF' },
  { name: 'PDFâ†’Word', href: '/pdf/pdf-to-word', icon: 'ğŸ“', category: 'PDF', popular: true },
  { name: 'Wordâ†’PDF', href: '/pdf/word-to-pdf', icon: 'ğŸ“„', category: 'PDF' },
  { name: 'Excelâ†’PDF', href: '/pdf/excel-to-pdf', icon: 'ğŸ“Š', category: 'PDF' },
  { name: 'PDFâ†’Excel', href: '/pdf/pdf-to-excel', icon: 'ğŸ“Š', category: 'PDF' },
  { name: 'PowerPointâ†’PDF', href: '/pdf/ppt-to-pdf', icon: 'ğŸ“Š', category: 'PDF' },
  { name: 'PDFâ†’PowerPoint', href: '/pdf/pdf-to-ppt', icon: 'ğŸ“Š', category: 'PDF' },
  { name: 'ç”»åƒâ†’PDF', href: '/pdf/image-to-pdf', icon: 'ğŸ–¼ï¸', category: 'PDF' },
  { name: 'PDFâ†’ç”»åƒ', href: '/pdf/pdf-to-image', icon: 'ğŸ–¼ï¸', category: 'PDF' },
  { name: 'PDF OCR', href: '/pdf/ocr', icon: 'ğŸ‘ï¸', category: 'PDF' },
  { name: 'PDFãƒšãƒ¼ã‚¸å‰Šé™¤', href: '/pdf/delete-pages', icon: 'ğŸ—‘ï¸', category: 'PDF' },
  { name: 'PDFãƒšãƒ¼ã‚¸ä¸¦ã³æ›¿ãˆ', href: '/pdf/reorder', icon: 'ğŸ”„', category: 'PDF' },
  { name: 'ç”»åƒãƒªã‚µã‚¤ã‚º', href: '/image/resize', icon: 'ğŸ“', category: 'ç”»åƒ', popular: true },
  { name: 'ç”»åƒåœ§ç¸®', href: '/image/compress', icon: 'ğŸ—œï¸', category: 'ç”»åƒ' },
  { name: 'ç”»åƒåˆ‡ã‚ŠæŠœã', href: '/image/crop', icon: 'âœ‚ï¸', category: 'ç”»åƒ' },
  { name: 'ç”»åƒå›è»¢', href: '/image/rotate', icon: 'ğŸ”„', category: 'ç”»åƒ' },
  { name: 'ç”»åƒå½¢å¼å¤‰æ›', href: '/image/format-convert', icon: 'ğŸ”„', category: 'ç”»åƒ' },
  { name: 'QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ', href: '/image/qr-code', icon: 'ğŸ“±', category: 'ç”»åƒ', popular: true },
  { name: 'è«‹æ±‚æ›¸ä½œæˆ', href: '/document/invoice', icon: 'ğŸ“„', category: 'æ–‡æ›¸', popular: true },
  { name: 'è¦‹ç©æ›¸ä½œæˆ', href: '/document/quotation', icon: 'ğŸ“„', category: 'æ–‡æ›¸' },
  { name: 'é ˜åæ›¸ä½œæˆ', href: '/document/receipt', icon: 'ğŸ§¾', category: 'æ–‡æ›¸' },
  { name: 'ç´å“æ›¸ä½œæˆ', href: '/document/delivery-slip', icon: 'ğŸ“¦', category: 'æ–‡æ›¸' },
  { name: 'ååˆºä½œæˆ', href: '/document/business-card', icon: 'ğŸ’¼', category: 'æ–‡æ›¸' },
  { name: 'å±¥æ­´æ›¸ä½œæˆ', href: '/document/resume', icon: 'ğŸ“', category: 'æ–‡æ›¸' },
  { name: 'FAXé€ä»˜çŠ¶', href: '/document/fax-cover', icon: 'ğŸ“ ', category: 'æ–‡æ›¸' },
  { name: 'ãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«', href: '/document/business-email', icon: 'âœ‰ï¸', category: 'æ–‡æ›¸' },
  { name: 'é€ä»˜çŠ¶ä½œæˆ', href: '/document/cover-letter', icon: 'ğŸ“§', category: 'æ–‡æ›¸' },
  { name: 'ç¸¦æ›¸ãæ–‡æ›¸', href: '/document/vertical-text', icon: 'ğŸ“œ', category: 'æ–‡æ›¸' },
  { name: 'å’Œæš¦è¥¿æš¦å¤‰æ›', href: '/convert/wareki-seireki', icon: 'ğŸ“…', category: 'å¤‰æ›', popular: true },
  { name: 'å…¨è§’åŠè§’å¤‰æ›', href: '/convert/zenkaku-hankaku', icon: 'ï¼¡', category: 'å¤‰æ›' },
  { name: 'æ—¥ä»˜è¨ˆç®—', href: '/convert/date-converter', icon: 'ğŸ“†', category: 'å¤‰æ›' },
  { name: 'å˜ä½æ›ç®—', href: '/convert/unit', icon: 'ğŸ“', category: 'å¤‰æ›', popular: true },
  { name: 'Base64å¤‰æ›', href: '/convert/base64', icon: 'ğŸ”¢', category: 'å¤‰æ›' },
  { name: 'URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰', href: '/convert/url-encode', icon: 'ğŸ”—', category: 'å¤‰æ›' },
  { name: 'éƒµä¾¿ç•ªå·æ¤œç´¢', href: '/convert/postcode', icon: 'ğŸ“®', category: 'å¤‰æ›' },
  { name: 'é›»è©±ç•ªå·æ•´å½¢', href: '/convert/phone-formatter', icon: 'ğŸ“', category: 'å¤‰æ›' },
  { name: 'ãµã‚ŠãŒãªå¤‰æ›', href: '/convert/furigana', icon: 'ã‚', category: 'å¤‰æ›' },
  { name: 'éŠ€è¡Œå£åº§å½¢å¼å¤‰æ›', href: '/convert/bank-format', icon: 'ğŸ¦', category: 'å¤‰æ›' },
  { name: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ', href: '/generator/password', icon: 'ğŸ”', category: 'ç”Ÿæˆ', popular: true },
  { name: 'QRã‚³ãƒ¼ãƒ‰èª­å–', href: '/generator/qr-reader', icon: 'ğŸ“·', category: 'ç”Ÿæˆ' },
  { name: 'ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ', href: '/generator/hash', icon: '#ï¸âƒ£', category: 'ç”Ÿæˆ' },
  { name: 'ãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸', href: '/generator/random-picker', icon: 'ğŸ²', category: 'ç”Ÿæˆ', popular: true },
  { name: 'æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ', href: '/generator/character-count', icon: 'ğŸ”¢', category: 'ç”Ÿæˆ' },
  { name: 'Lorem Ipsumç”Ÿæˆ', href: '/generator/lorem-ipsum', icon: 'ğŸ“', category: 'ç”Ÿæˆ' },
  { name: 'JSONæ•´å½¢', href: '/generator/json-format', icon: '{ }', category: 'ç”Ÿæˆ' },
  { name: 'æ­£è¦è¡¨ç¾ãƒ†ã‚¹ãƒˆ', href: '/generator/regex-test', icon: '.*', category: 'ç”Ÿæˆ' },
  { name: 'ãƒ†ã‚­ã‚¹ãƒˆå·®åˆ†æ¯”è¼ƒ', href: '/generator/text-diff', icon: 'âš–ï¸', category: 'ç”Ÿæˆ' },
  { name: 'å¤§æ–‡å­—å°æ–‡å­—å¤‰æ›', href: '/generator/text-case', icon: 'Aa', category: 'ç”Ÿæˆ' },
  { name: 'å¹´é½¢è¨ˆç®—', href: '/generator/age-calc', icon: 'ğŸ‘¶', category: 'ç”Ÿæˆ' },
  { name: 'çµ¦ä¸è¨ˆç®—', href: '/generator/salary-calc', icon: 'ğŸ’°', category: 'ç”Ÿæˆ' },
  { name: 'ç¨é‡‘è¨ˆç®—', href: '/generator/tax-calculator', icon: 'ğŸ’´', category: 'ç”Ÿæˆ' },
  { name: 'å¹´æœ«èª¿æ•´è¨ˆç®—', href: '/generator/nenmatsu-calc', icon: 'ğŸ“Š', category: 'ç”Ÿæˆ' },
  { name: 'ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç•ªå·ãƒã‚§ãƒƒã‚¯', href: '/generator/t-number', icon: 'Tï¸', category: 'ç”Ÿæˆ' },
  { name: 'ç¥æ—¥åˆ¤å®š', href: '/generator/holiday-checker', icon: 'ğŸŒ', category: 'ç”Ÿæˆ' },
  { name: 'ãƒ‡ã‚¸ã‚¿ãƒ«åˆ¤å­', href: '/generator/hanko', icon: 'ğŸ”´', category: 'ç”Ÿæˆ', popular: true },
  { name: 'å°ç­’å°åˆ·', href: '/generator/envelope-print', icon: 'âœ‰ï¸', category: 'ç”Ÿæˆ' },
  { name: 'ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å¤‰æ›', href: '/generator/color-convert', icon: 'ğŸ¨', category: 'ç”Ÿæˆ' },
  { name: 'ZIPæš—å·åŒ–', href: '/generator/password-zip', icon: 'ğŸ”’', category: 'ç”Ÿæˆ' },
  { name: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆå™¨', href: '/generator/password-gen', icon: 'ğŸ”‘', category: 'ç”Ÿæˆ' },
  { name: 'æ–‡å­—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼', href: '/generator/char-count', icon: 'ğŸ“', category: 'ç”Ÿæˆ' },
  { name: 'å˜ä½å¤‰æ›å™¨', href: '/generator/unit-convert', icon: 'ğŸ“', category: 'ç”Ÿæˆ' },
];

export default function HomePage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [showSuggestions, setShowSuggestions] = useState(false);

  const recentPosts = getPublishedPosts().slice(0, 3); // Already sorted newest first
  const popularTools = allTools.filter(t => t.popular);
  
  const filteredTools = searchQuery.length > 0
    ? allTools.filter(tool => tool.name.toLowerCase().includes(searchQuery.toLowerCase()))
    : [];

  const categories = [
    { name: 'PDFãƒ„ãƒ¼ãƒ«', href: '/pdf', icon: 'ğŸ“„', count: 20, color: 'bg-red-50 hover:bg-red-100' },
    { name: 'ç”»åƒãƒ„ãƒ¼ãƒ«', href: '/image', icon: 'ğŸ–¼ï¸', count: 6, color: 'bg-blue-50 hover:bg-blue-100' },
    { name: 'æ–‡æ›¸ä½œæˆ', href: '/document', icon: 'ğŸ“', count: 10, color: 'bg-green-50 hover:bg-green-100' },
    { name: 'å¤‰æ›ãƒ„ãƒ¼ãƒ«', href: '/convert', icon: 'ğŸ”„', count: 10, color: 'bg-yellow-50 hover:bg-yellow-100' },
    { name: 'ç”Ÿæˆãƒ»è¨ˆç®—', href: '/generator', icon: 'âš™ï¸', count: 25, color: 'bg-purple-50 hover:bg-purple-100' },
  ];

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Hero Section (same as before) */}
      <section className="bg-gradient-to-b from-kon to-kon/90 text-white py-20">
        <div className="max-w-6xl mx-auto px-4 text-center">
          <h1 className="text-5xl md:text-6xl font-bold mb-6">ğŸ› ï¸ å±±ç”°ãƒ„ãƒ¼ãƒ«</h1>
          <p className="text-2xl md:text-3xl mb-4 text-sakura font-medium">æ—¥æœ¬æœ€å¤§ç´šã®ç„¡æ–™ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«é›†</p>
          <p className="text-xl md:text-2xl mb-8 text-gray-200">ç™»éŒ²ä¸è¦ãƒ»å³åº§ã«åˆ©ç”¨é–‹å§‹</p>
          
          <div className="flex flex-wrap justify-center gap-6 mb-10 text-lg">
            <div className="flex items-center gap-2"><span className="text-2xl">âœ…</span><span>71ç¨®é¡ã®ãƒ„ãƒ¼ãƒ«ãŒå®Œå…¨ç„¡æ–™</span></div>
            <div className="flex items-center gap-2"><span className="text-2xl">âœ…</span><span>ç™»éŒ²ä¸è¦ãƒ»å³åº§ã«åˆ©ç”¨</span></div>
            <div className="flex items-center gap-2"><span className="text-2xl">âœ…</span><span>æ—¥æœ¬å›½å†…ã‚µãƒ¼ãƒãƒ¼ã§å®‰å¿ƒ</span></div>
          </div>

          <div className="max-w-2xl mx-auto relative">
            <div className="relative">
              <input
                type="text"
                placeholder="ğŸ” ãƒ„ãƒ¼ãƒ«ã‚’æ¤œç´¢ (ä¾‹: PDF, ç”»åƒ, è«‹æ±‚æ›¸...)"
                className="w-full px-6 py-4 rounded-full text-gray-900 text-lg focus:outline-none focus:ring-4 focus:ring-sakura/50 shadow-2xl"
                value={searchQuery}
                onChange={(e) => {
                  setSearchQuery(e.target.value);
                  setShowSuggestions(e.target.value.length > 0);
                }}
                onFocus={() => setShowSuggestions(searchQuery.length > 0)}
                onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
              />
              
              {showSuggestions && filteredTools.length > 0 && (
                <div className="absolute top-full mt-2 w-full bg-white rounded-2xl shadow-2xl max-h-96 overflow-y-auto z-50">
                  {filteredTools.slice(0, 8).map((tool) => (
                    <Link
                      key={tool.href}
                      href={tool.href}
                      className="flex items-center gap-3 px-6 py-3 hover:bg-gray-50 transition-colors border-b last:border-b-0"
                    >
                      <span className="text-2xl">{tool.icon}</span>
                      <span className="font-medium text-gray-900">{tool.name}</span>
                      <span className="text-xs text-gray-500 ml-auto">{tool.category}</span>
                    </Link>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      </section>

      {/* Popular Tools */}
      <section className="max-w-6xl mx-auto px-4 py-12">
        <h2 className="text-2xl font-bold text-gray-900 mb-6">ğŸ”¥ äººæ°—ã®ãƒ„ãƒ¼ãƒ«</h2>
        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
          {popularTools.map((tool) => (
            <Link key={tool.href} href={tool.href} className="bg-white rounded-xl p-4 text-center hover:shadow-xl transition-all border-2 border-transparent hover:border-sakura">
              <div className="text-4xl mb-2">{tool.icon}</div>
              <div className="font-bold text-sm text-gray-900">{tool.name}</div>
            </Link>
          ))}
        </div>
      </section>

      {/* Categories */}
      <section className="max-w-6xl mx-auto px-4 py-16">
        <h2 className="text-3xl font-bold text-gray-900 mb-8 text-center">ğŸ“š ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‹ã‚‰æ¢ã™</h2>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
          {categories.map((cat) => (
            <Link key={cat.name} href={cat.href} className={`${cat.color} rounded-xl p-6 text-center transition-all shadow-md hover:shadow-xl border-2 border-transparent hover:border-sakura`}>
              <div className="text-5xl mb-3">{cat.icon}</div>
              <div className="font-bold text-gray-900 mb-1">{cat.name}</div>
              <div className="text-sm text-gray-600">{cat.count}ç¨®é¡</div>
            </Link>
          ))}
        </div>
      </section>

      {/* Blog Section with NEW badges */}
      <section className="bg-white py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="flex items-center justify-between mb-8">
            <h2 className="text-3xl font-bold text-gray-900">ğŸ“š ãŠå½¹ç«‹ã¡è¨˜äº‹</h2>
            <Link href="/blog" className="text-sakura font-bold hover:underline">è¨˜äº‹ä¸€è¦§ã¸ â†’</Link>
          </div>
          
          <p className="text-gray-600 mb-8">ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹ã‚„æ¥­å‹™åŠ¹ç‡åŒ–ã®ãƒ’ãƒ³ãƒˆ</p>

          <div className="grid md:grid-cols-3 gap-6">
            {recentPosts.map((post) => (
              <Link key={post.slug} href={`/blog/${post.slug}`} className="group bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all border border-gray-100 relative">
                {/* NEW Badge */}
                {isNewBlog(post.publishDate) && (
                  <div className="absolute top-4 left-4 z-10 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg animate-pulse">
                    ğŸ†• NEW
                  </div>
                )}
                
                {post.imageType === 'css' ? (
                  <BlogThumbnail type={post.image} />
                ) : (
                  <img src={post.image} alt={post.title} className="w-full h-48 object-cover" />
                )}
                <div className="p-4">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="inline-block bg-sakura text-white text-xs font-bold px-3 py-1 rounded">
                      {post.category}
                    </span>
                    <span className="text-xs text-gray-500">
                      {new Date(post.publishDate).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}
                    </span>
                  </div>
                  <h3 className="font-bold text-gray-900 group-hover:text-sakura transition-colors mb-2 line-clamp-2">
                    {post.title}
                  </h3>
                  <p className="text-sm text-gray-600 mb-3 line-clamp-2">{post.excerpt}</p>
                  <div className="text-xs text-gray-500">
                    â±ï¸ {post.readTime}
                  </div>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>

      {/* Security Section */}
      <section className="bg-gradient-to-br from-kon to-kon/95 text-white py-16">
        <div className="max-w-4xl mx-auto px-4 text-center">
          <div className="text-6xl mb-6">ğŸ›¡ï¸</div>
          <h2 className="text-3xl font-bold mb-4">å®‰å¿ƒãƒ»å®‰å…¨ã®ç†ç”±</h2>
          <div className="grid md:grid-cols-3 gap-8 mt-10">
            <div className="bg-white/10 rounded-xl p-6 backdrop-blur">
              <div className="text-5xl mb-4">ğŸ‡¯ğŸ‡µ</div>
              <h3 className="font-bold text-xl mb-2">æ—¥æœ¬å›½å†…ã‚µãƒ¼ãƒãƒ¼</h3>
              <p className="text-sm text-gray-200">å¤§åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¥æœ¬å›½å†…ã§å‡¦ç†ã€‚ãƒ‡ãƒ¼ã‚¿ä¸»æ¨©ã‚’å®ˆã‚Šã¾ã™ã€‚</p>
            </div>
            <div className="bg-white/10 rounded-xl p-6 backdrop-blur">
              <div className="text-5xl mb-4">ğŸ”’</div>
              <h3 className="font-bold text-xl mb-2">SSLæš—å·åŒ–é€šä¿¡</h3>
              <p className="text-sm text-gray-200">é€šä¿¡å†…å®¹ã‚’å®Œå…¨ä¿è­·ã€‚å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>
            </div>
            <div className="bg-white/10 rounded-xl p-6 backdrop-blur">
              <div className="text-5xl mb-4">ğŸ—‘ï¸</div>
              <h3 className="font-bold text-xl mb-2">60åˆ†ä»¥å†…ã«è‡ªå‹•å‰Šé™¤</h3>
              <p className="text-sm text-gray-200">å‡¦ç†å®Œäº†å¾Œã€ã™ãã«å‰Šé™¤ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã—ã¾ã›ã‚“ã€‚</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  );
}
