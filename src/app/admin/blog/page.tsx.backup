'use client';
import { useState, useEffect } from 'react';
import { getPublishedPosts } from '@/data/blogPosts';

export default function BlogAdminPage() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [password, setPassword] = useState('');
  const [step, setStep] = useState(1);
  
  const [topic, setTopic] = useState('');
  const [generatedPrompt, setGeneratedPrompt] = useState('');
  
  const [blogContent, setBlogContent] = useState('');
  const [autoCategory, setAutoCategory] = useState('');
  const [autoTags, setAutoTags] = useState<string[]>([]);
  const [autoToolLink, setAutoToolLink] = useState('');
  const [autoExcerpt, setAutoExcerpt] = useState('');
  
  const [imageOption, setImageOption] = useState<'css' | 'upload'>('css');
  const [uploadedImage, setUploadedImage] = useState('');
  const [publishDate, setPublishDate] = useState('');
  const [publishTime, setPublishTime] = useState('');
  
  const [existingBlogs, setExistingBlogs] = useState<any[]>([]);
  const [isPublishing, setIsPublishing] = useState(false);

  useEffect(() => {
    if (isAuthenticated) {
      loadBlogs();
    }
  }, [isAuthenticated]);

  const loadBlogs = () => {
    const blogs = getPublishedPosts();
    setExistingBlogs(blogs);
  };

  const handleLogin = (e: React.FormEvent) => {
    e.preventDefault();
    if (password === 'yamada-admin-2024') {
      setIsAuthenticated(true);
    } else {
      alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
    }
  };

  const generatePrompt = () => {
    const prompt = `# å±±ç”°ãƒ„ãƒ¼ãƒ« ãƒ–ãƒ­ã‚°è¨˜äº‹ä½œæˆä¾é ¼

## è¨˜äº‹ãƒ†ãƒ¼ãƒ
${topic}

## åŸ·ç­†ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### è¨€èªãƒ»æ–‡åŒ–
- **å®Œå…¨ãªæ—¥æœ¬èªãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ã‚¤ãƒ«**ã§åŸ·ç­†ã—ã¦ãã ã•ã„
- æ—¥æœ¬ã®ãƒ“ã‚¸ãƒã‚¹æ–‡åŒ–ã«ç²¾é€šã—ãŸæ›¸ãæ–¹ï¼ˆæ•¬èªã€ãƒ“ã‚¸ãƒã‚¹ãƒãƒŠãƒ¼ï¼‰
- ä¼šè©±å½¢å¼ï¼šç”°ä¸­ã•ã‚“ï¼ˆå›°ã£ã¦ã„ã‚‹äººï¼‰ã¨å±±ç”°ï¼ˆè§£æ±ºã™ã‚‹äººï¼‰ã®å¯¾è©±ã‚’å«ã‚ã‚‹
- æ—¥æœ¬ç‰¹æœ‰ã®çŠ¶æ³ã‚„ä¾‹ã‚’ä½¿ç”¨ï¼ˆä¼šç¤¾ã€ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ã€ä¸»å©¦ãªã©ï¼‰

### SEOæœ€é©åŒ–
- **Googleã®æ—¥æœ¬æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³**ã‚’æ„è­˜ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é¸å®š
- ã‚¿ã‚¤ãƒˆãƒ«ã«æ¤œç´¢ã•ã‚Œã‚„ã™ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚ã‚‹
- è¦‹å‡ºã—ã«ã‚‚SEOã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«é…ç½®
- ãƒ¡ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç”¨ã®è¦ç´„æ–‡ï¼ˆ50-80æ–‡å­—ï¼‰ã‚’å«ã‚ã‚‹

### æ§‹æˆ
- **èª­äº†æ™‚é–“: 3-4åˆ†** ï¼ˆ1,500-2,000æ–‡å­—ç¨‹åº¦ï¼‰
- å†’é ­ï¼šå•é¡Œæèµ·ï¼ˆã€Œã“ã‚“ãªçµŒé¨“ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿã€ï¼‰
- ä¼šè©±ä¾‹ï¼šç”°ä¸­ã•ã‚“ã¨å±±ç”°ã®å¯¾è©±
- è§£æ±ºç­–ï¼šå±±ç”°ãƒ„ãƒ¼ãƒ«ã®ç´¹ä»‹
- æ‰‹é †ï¼šã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ä½¿ã„æ–¹
- ãƒ¡ãƒªãƒƒãƒˆï¼šä»–ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ
- ã¾ã¨ã‚ï¼šè¡Œå‹•å–šèµ·ï¼ˆCTAï¼‰

### ãƒˆãƒ¼ãƒ³
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§è¦ªã—ã¿ã‚„ã™ã„
- å°‚é–€ç”¨èªã¯é¿ã‘ã€èª°ã§ã‚‚ç†è§£ã§ãã‚‹è¡¨ç¾
- å®Ÿä¾‹ã‚„å…·ä½“çš„ãªã‚·ãƒ¼ãƒ³ã‚’å¤šç”¨
- ãƒã‚¸ãƒ†ã‚£ãƒ–ã§åŠ±ã¾ã™å£èª¿

### å¿…é ˆè¦ç´ 
1. ã‚­ãƒ£ãƒƒãƒãƒ¼ãªã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30-40æ–‡å­—ã€ã€ã€‘ã‚’ä½¿ç”¨ï¼‰
2. å°å…¥éƒ¨åˆ†ï¼ˆå•é¡Œã®å…±æ„Ÿï¼‰
3. ä¼šè©±å½¢å¼ã®ã‚„ã‚Šå–ã‚Šï¼ˆæœ€ä½2å›ï¼‰
4. å±±ç”°ãƒ„ãƒ¼ãƒ«ã®å…·ä½“çš„ãªä½¿ã„æ–¹ï¼ˆ3-5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
5. æ¯”è¼ƒè¡¨ã‚„ãƒ¡ãƒªãƒƒãƒˆä¸€è¦§
6. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆQ&Aå½¢å¼ã€3-5å€‹ï¼‰
7. ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å‡ºåŠ›å½¢å¼
ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ã€è¦‹å‡ºã—ã¯æ˜ç¢ºã«ã€‚

---

**ã“ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€å®Œç’§ãªæ—¥æœ¬èªãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚**`;

    setGeneratedPrompt(prompt);
  };

  const copyPrompt = () => {
    navigator.clipboard.writeText(generatedPrompt);
    alert('âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Claudeã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
  };

  const analyzeContent = () => {
    if (!blogContent) return;

    const categories = {
      'PDF': ['pdf', 'ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼ã‚¨ãƒ•', 'çµåˆ', 'åœ§ç¸®', 'åˆ†å‰²'],
      'ç”»åƒ': ['ç”»åƒ', 'ã‚¤ãƒ¡ãƒ¼ã‚¸', 'ãƒªã‚µã‚¤ã‚º', 'åœ§ç¸®', 'ãƒ¡ãƒ«ã‚«ãƒª'],
      'æ–‡æ›¸ä½œæˆ': ['è«‹æ±‚æ›¸', 'è¦‹ç©', 'é ˜å', 'ã‚¤ãƒ³ãƒœã‚¤ã‚¹', 'æ–‡æ›¸'],
      'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£': ['ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', 'å®‰å…¨', 'å±é™º', 'æµ·å¤–'],
      'ç”Ÿæˆãƒ„ãƒ¼ãƒ«': ['ç”Ÿæˆ', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', 'ãƒ„ãƒ¼ãƒ«', 'è¨ˆç®—'],
    };

    let detectedCategory = '';
    for (const [cat, keywords] of Object.entries(categories)) {
      if (keywords.some(kw => blogContent.toLowerCase().includes(kw))) {
        detectedCategory = cat;
        break;
      }
    }
    setAutoCategory(detectedCategory || 'ãã®ä»–');

    const commonTags = ['PDF', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', 'ç”»åƒ', 'ãƒªã‚µã‚¤ã‚º', 'è«‹æ±‚æ›¸', 
                        'ã‚¤ãƒ³ãƒœã‚¤ã‚¹', 'ãƒ“ã‚¸ãƒã‚¹', 'åœ§ç¸®', 'ãƒ¡ãƒ¼ãƒ«', 'ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹', 
                        'ç”Ÿæˆ', 'å®‰å…¨', 'ãƒ¡ãƒ«ã‚«ãƒª', 'ã‚¹ãƒãƒ›'];
    const foundTags = commonTags.filter(tag => 
      blogContent.toLowerCase().includes(tag.toLowerCase())
    ).slice(0, 4);
    setAutoTags(foundTags);

    const toolLinks = {
      'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰': '/generator/password',
      'pdf.*åœ§ç¸®': '/pdf/compress',
      'pdf.*çµåˆ': '/pdf/merge',
      'ç”»åƒ.*ãƒªã‚µã‚¤ã‚º': '/image/resize',
      'è«‹æ±‚æ›¸': '/document/invoice',
    };

    let detectedLink = '';
    for (const [pattern, link] of Object.entries(toolLinks)) {
      const regex = new RegExp(pattern, 'i');
      if (regex.test(blogContent)) {
        detectedLink = link;
        break;
      }
    }
    setAutoToolLink(detectedLink || '/');

    const sentences = blogContent.split(/[ã€‚ï¼ï¼Ÿ]/);
    const excerpt = sentences.slice(0, 2).join('ã€‚') + 'ã€‚';
    setAutoExcerpt(excerpt.substring(0, 150));
  };

  const publishBlog = async (status: 'now' | 'draft' | 'schedule') => {
    setIsPublishing(true);
    
    const slug = topic.toLowerCase()
      .replace(/[ã€ã€‘]/g, '')
      .replace(/[^\w\s-]/g, '')
      .replace(/\s+/g, '-')
      .substring(0, 50) + '-' + Date.now();

    const blogData = {
      slug,
      title: topic,
      excerpt: autoExcerpt,
      content: blogContent,
      category: autoCategory,
      tags: autoTags,
      image: imageOption === 'css' ? autoCategory.toLowerCase().replace(/ãƒ„ãƒ¼ãƒ«/, '') : uploadedImage,
      imageType: imageOption,
      publishDate: status === 'now' ? new Date().toISOString() : 
                    status === 'schedule' ? `${publishDate}T${publishTime}:00+09:00` :
                    '2099-01-01T00:00:00+09:00',
      author: 'å±±ç”°ãƒ„ãƒ¼ãƒ«ç·¨é›†éƒ¨',
      readTime: Math.ceil(blogContent.length / 600) + 'åˆ†',
      toolLink: autoToolLink,
    };

    try {
      const response = await fetch('/api/blog', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(blogData),
      });

      const result = await response.json();

      if (result.success) {
        alert(`âœ… ãƒ–ãƒ­ã‚°ã‚’${status === 'now' ? 'å…¬é–‹' : status === 'draft' ? 'ä¸‹æ›¸ãä¿å­˜' : 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«'}ã—ã¾ã—ãŸï¼`);
        setStep(1);
        setTopic('');
        setBlogContent('');
        setAutoCategory('');
        loadBlogs(); // Reload blogs
      } else {
        alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + result.error);
      }
    } catch (error) {
      alert('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error);
    }
    
    setIsPublishing(false);
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-kon to-kon/90 flex items-center justify-center p-4">
        <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
          <h1 className="text-3xl font-bold text-gray-900 mb-6 text-center">ğŸ” ãƒ–ãƒ­ã‚°ç®¡ç†</h1>
          <form onSubmit={handleLogin}>
            <input
              type="password"
              placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-sakura"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
            <button className="w-full bg-kon text-white py-3 rounded-lg font-bold hover:bg-kon/90">
              ãƒ­ã‚°ã‚¤ãƒ³
            </button>
          </form>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <div className="max-w-5xl mx-auto">
        <h1 className="text-4xl font-bold text-gray-900 mb-8">ğŸ“ ãƒ–ãƒ­ã‚°ä½œæˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

        {/* Progress Steps */}
        <div className="bg-white rounded-xl p-6 mb-8 shadow-md">
          <div className="flex items-center justify-between">
            <div className={`flex-1 text-center ${step >= 1 ? 'text-kon font-bold' : 'text-gray-400'}`}>
              <div className={`w-10 h-10 rounded-full mx-auto mb-2 flex items-center justify-center ${step >= 1 ? 'bg-kon text-white' : 'bg-gray-200'}`}>1</div>
              ãƒˆãƒ”ãƒƒã‚¯å…¥åŠ›
            </div>
            <div className="flex-1 border-t-2 border-gray-300 mx-4"></div>
            <div className={`flex-1 text-center ${step >= 2 ? 'text-kon font-bold' : 'text-gray-400'}`}>
              <div className={`w-10 h-10 rounded-full mx-auto mb-2 flex items-center justify-center ${step >= 2 ? 'bg-kon text-white' : 'bg-gray-200'}`}>2</div>
              ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ
            </div>
            <div className="flex-1 border-t-2 border-gray-300 mx-4"></div>
            <div className={`flex-1 text-center ${step >= 3 ? 'text-kon font-bold' : 'text-gray-400'}`}>
              <div className={`w-10 h-10 rounded-full mx-auto mb-2 flex items-center justify-center ${step >= 3 ? 'bg-kon text-white' : 'bg-gray-200'}`}>3</div>
              å…¬é–‹è¨­å®š
            </div>
          </div>
        </div>

        {/* Step 1: Topic & Prompt */}
        {step === 1 && (
          <div className="bg-white rounded-xl p-8 shadow-md">
            <h2 className="text-2xl font-bold mb-6">ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ–ãƒ­ã‚°ãƒˆãƒ”ãƒƒã‚¯å…¥åŠ›</h2>
            
            <label className="block mb-2 font-bold text-gray-700">ãƒ–ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒˆãƒ”ãƒƒã‚¯</label>
            <input
              type="text"
              placeholder="ä¾‹: PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’åœ§ç¸®ã™ã‚‹æ–¹æ³•"
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-6 focus:outline-none focus:border-sakura text-lg"
              value={topic}
              onChange={(e) => setTopic(e.target.value)}
            />

            <button
              onClick={generatePrompt}
              disabled={!topic}
              className="bg-kon text-white px-8 py-3 rounded-lg font-bold hover:bg-kon/90 disabled:bg-gray-300 mb-6"
            >
              ğŸ¤– AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
            </button>

            {generatedPrompt && (
              <div className="mt-6">
                <div className="flex items-center justify-between mb-2">
                  <label className="font-bold text-gray-700">ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
                  <button
                    onClick={copyPrompt}
                    className="bg-sakura text-white px-4 py-2 rounded-lg font-bold hover:bg-sakura/90"
                  >
                    ğŸ“‹ ã‚³ãƒ”ãƒ¼
                  </button>
                </div>
                <textarea
                  readOnly
                  value={generatedPrompt}
                  className="w-full h-96 px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-50 font-mono text-sm"
                />
                <p className="mt-4 text-gray-600 bg-blue-50 p-4 rounded-lg">
                  âœ… <strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong> ä¸Šã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€Claudeã®ãƒãƒ£ãƒƒãƒˆã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ClaudeãŒå®Œç’§ãªãƒ–ãƒ­ã‚°ã‚’ç”Ÿæˆã—ã¾ã™ï¼
                </p>
                <button
                  onClick={() => setStep(2)}
                  className="mt-6 bg-kon text-white px-8 py-3 rounded-lg font-bold hover:bg-kon/90"
                >
                  æ¬¡ã¸: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥åŠ› â†’
                </button>
              </div>
            )}
          </div>
        )}

        {/* Step 2: Content Input */}
        {step === 2 && (
          <div className="bg-white rounded-xl p-8 shadow-md">
            <h2 className="text-2xl font-bold mb-6">ã‚¹ãƒ†ãƒƒãƒ—2: ClaudeãŒç”Ÿæˆã—ãŸãƒ–ãƒ­ã‚°ã‚’è²¼ã‚Šä»˜ã‘</h2>
            
            <label className="block mb-2 font-bold text-gray-700">ãƒ–ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</label>
            <textarea
              placeholder="ClaudeãŒç”Ÿæˆã—ãŸãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."
              className="w-full h-96 px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-sakura"
              value={blogContent}
              onChange={(e) => setBlogContent(e.target.value)}
            />

            <button
              onClick={analyzeContent}
              disabled={!blogContent}
              className="bg-kon text-white px-8 py-3 rounded-lg font-bold hover:bg-kon/90 disabled:bg-gray-300 mb-6"
            >
              ğŸ” AIåˆ†æ (ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°ãƒ»ãƒ„ãƒ¼ãƒ«ãƒªãƒ³ã‚¯è‡ªå‹•æ¤œå‡º)
            </button>

            {autoCategory && (
              <div className="mt-6 p-6 bg-green-50 rounded-lg border-2 border-green-200">
                <h3 className="font-bold text-lg mb-4">âœ… AIåˆ†æçµæœ</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <p className="text-sm text-gray-600 mb-1">ã‚«ãƒ†ã‚´ãƒª</p>
                    <p className="font-bold text-lg">{autoCategory}</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600 mb-1">æ¨å¥¨ãƒ„ãƒ¼ãƒ«ãƒªãƒ³ã‚¯</p>
                    <p className="font-bold">{autoToolLink}</p>
                  </div>
                  <div className="md:col-span-2">
                    <p className="text-sm text-gray-600 mb-1">ã‚¿ã‚°</p>
                    <div className="flex flex-wrap gap-2">
                      {autoTags.map(tag => (
                        <span key={tag} className="bg-sakura text-white px-3 py-1 rounded-full text-sm">
                          #{tag}
                        </span>
                      ))}
                    </div>
                  </div>
                  <div className="md:col-span-2">
                    <p className="text-sm text-gray-600 mb-1">è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸè¦ç´„</p>
                    <p className="text-sm">{autoExcerpt}</p>
                  </div>
                </div>
              </div>
            )}

            <div className="flex gap-4 mt-6">
              <button
                onClick={() => setStep(1)}
                className="bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-bold hover:bg-gray-400"
              >
                â† æˆ»ã‚‹
              </button>
              <button
                onClick={() => setStep(3)}
                disabled={!autoCategory}
                className="bg-kon text-white px-8 py-3 rounded-lg font-bold hover:bg-kon/90 disabled:bg-gray-300"
              >
                æ¬¡ã¸: å…¬é–‹è¨­å®š â†’
              </button>
            </div>
          </div>
        )}

        {/* Step 3: Publishing */}
        {step === 3 && (
          <div className="bg-white rounded-xl p-8 shadow-md">
            <h2 className="text-2xl font-bold mb-6">ã‚¹ãƒ†ãƒƒãƒ—3: å…¬é–‹è¨­å®š</h2>

            <div className="mb-6">
              <label className="block mb-2 font-bold text-gray-700">ç”»åƒè¨­å®š</label>
              <div className="flex gap-4 mb-4">
                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="radio"
                    checked={imageOption === 'css'}
                    onChange={() => setImageOption('css')}
                    className="w-5 h-5"
                  />
                  CSSè‡ªå‹•ç”Ÿæˆã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼ˆæ¨å¥¨ï¼‰
                </label>
                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="radio"
                    checked={imageOption === 'upload'}
                    onChange={() => setImageOption('upload')}
                    className="w-5 h-5"
                  />
                  ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </label>
              </div>

              {imageOption === 'upload' && (
                <input
                  type="text"
                  placeholder="ç”»åƒURL"
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-sakura"
                  value={uploadedImage}
                  onChange={(e) => setUploadedImage(e.target.value)}
                />
              )}
            </div>

            <div className="mb-6">
              <label className="block mb-2 font-bold text-gray-700">å…¬é–‹æ—¥æ™‚ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æŠ•ç¨¿ï¼‰</label>
              <div className="flex gap-4">
                <input
                  type="date"
                  className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-sakura"
                  value={publishDate}
                  onChange={(e) => setPublishDate(e.target.value)}
                />
                <input
                  type="time"
                  className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-sakura"
                  value={publishTime}
                  onChange={(e) => setPublishTime(e.target.value)}
                />
              </div>
            </div>

            <div className="flex flex-wrap gap-4 mt-8">
              <button
                onClick={() => setStep(2)}
                className="bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-bold hover:bg-gray-400"
              >
                â† æˆ»ã‚‹
              </button>
              <button
                onClick={() => publishBlog('now')}
                disabled={isPublishing}
                className="bg-kon text-white px-8 py-3 rounded-lg font-bold hover:bg-kon/90 disabled:bg-gray-400"
              >
                {isPublishing ? 'ä¿å­˜ä¸­...' : 'ğŸš€ ä»Šã™ãå…¬é–‹'}
              </button>
              <button
                onClick={() => publishBlog('draft')}
                disabled={isPublishing}
                className="bg-gray-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-700 disabled:bg-gray-400"
              >
                ğŸ’¾ ä¸‹æ›¸ãä¿å­˜
              </button>
              {publishDate && publishTime && (
                <button
                  onClick={() => publishBlog('schedule')}
                  disabled={isPublishing}
                  className="bg-sakura text-white px-8 py-3 rounded-lg font-bold hover:bg-sakura/90 disabled:bg-gray-400"
                >
                  ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æŠ•ç¨¿
                </button>
              )}
            </div>
          </div>
        )}

        {/* Existing Blogs - Sorted by Date (Newest First) */}
        <div className="bg-white rounded-xl p-8 shadow-md mt-8">
          <h2 className="text-2xl font-bold mb-6">ğŸ“š æ—¢å­˜ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ (æ–°ã—ã„é †)</h2>
          <div className="space-y-4">
            {existingBlogs.map((blog) => (
              <div key={blog.slug} className="border-2 border-gray-200 rounded-lg p-4 hover:border-sakura transition-colors relative">
                {/* NEW Badge in Dashboard */}
                {(() => {
                  const blogDate = new Date(blog.publishDate);
                  const now = new Date();
                  const diffDays = (now.getTime() - blogDate.getTime()) / (1000 * 60 * 60 * 24);
                  return diffDays <= 7 ? (
                    <div className="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full animate-pulse">
                      ğŸ†• NEW
                    </div>
                  ) : null;
                })()}
                
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="inline-block bg-sakura text-white text-xs px-2 py-1 rounded">
                        {blog.category}
                      </span>
                      <span className="text-xs text-gray-500">
                        {new Date(blog.publishDate).toLocaleDateString('ja-JP')} {new Date(blog.publishDate).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}
                      </span>
                    </div>
                    <h3 className="font-bold text-lg mb-1">{blog.title}</h3>
                    <p className="text-sm text-gray-600 mb-2 line-clamp-2">{blog.excerpt}</p>
                    <div className="flex flex-wrap gap-2 mt-2">
                      {blog.tags.map((tag: string) => (
                        <span key={tag} className="text-xs text-gray-500">#{tag}</span>
                      ))}
                    </div>
                  </div>
                  <div className="flex gap-2 ml-4">
                    
                    <a
                      href={`/blog/${blog.slug}`}
                      target="_blank"
                      className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 text-sm"
                    >
                      è¡¨ç¤º
                    </a>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}
